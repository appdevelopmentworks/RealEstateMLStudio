# 要求定義書 (Requirements Specification)

**プロジェクト名**: RealEstateMLStudio  
**バージョン**: 2.3  
**最終更新**: 2026-01-01

---

## 1. プロジェクト概要

### 1.1 目的
不動産価格を機械学習モデルで予測し、予測根拠を説明可能な形で提供するWebアプリケーションを開発する。

### 1.2 ターゲットユーザー
- 不動産会社の営業担当者
- 不動産投資家
- 不動産鑑定士
- データサイエンティスト（不動産分析）

### 1.3 解決する課題
| 課題 | 解決策 |
|------|--------|
| 価格査定に時間がかかる | MLモデルによる即時予測 |
| 査定根拠が不明確 | SHAP分析による説明可能性 |
| 予測の不確実性が不明 | 信頼区間の提供 |
| 類似物件との比較が困難 | 類似物件自動検索 |
| レポート作成が手間 | PDF自動生成 |

---

## 2. 機能要件

### 2.1 必須機能（Must Have）

#### FR-001: データアップロード
| 項目 | 内容 |
|------|------|
| ID | FR-001 |
| 優先度 | 必須 |
| 説明 | CSVファイルをアップロードして学習データとして使用できる |
| 受入条件 | - CSV形式のみ対応<br>- 日本語カラム名対応<br>- プレビュー表示<br>- 基本情報（行数、列数、欠損値）表示 |

#### FR-002: サンプルデータ
| 項目 | 内容 |
|------|------|
| ID | FR-002 |
| 優先度 | 必須 |
| 説明 | デモ用のサンプルデータセットを提供する |
| 受入条件 | - カリフォルニア住宅データ<br>- 東京マンションデータ（架空）<br>- シンプル住宅データ<br>- ワンクリックで読み込み |

#### FR-003: データ前処理
| 項目 | 内容 |
|------|------|
| ID | FR-003 |
| 優先度 | 必須 |
| 説明 | データの自動前処理を実行できる |
| 受入条件 | - 欠損値処理（中央値/最頻値）<br>- カテゴリ変数エンコーディング<br>- 異常値処理（IQR法）<br>- スケーリング（オプション） |

#### FR-004: モデル学習
| 項目 | 内容 |
|------|------|
| ID | FR-004 |
| 優先度 | 必須 |
| 説明 | 複数のMLアルゴリズムでモデルを学習できる |
| 受入条件 | - XGBoost対応<br>- LightGBM対応<br>- CatBoost対応<br>- スタッキング（アンサンブル）対応<br>- 全モデル比較機能 |

#### FR-005: ハイパーパラメータチューニング
| 項目 | 内容 |
|------|------|
| ID | FR-005 |
| 優先度 | 必須 |
| 説明 | Optunaによる自動チューニングを実行できる |
| 受入条件 | - 試行回数を指定可能（10-200）<br>- 進捗表示<br>- 最適パラメータ表示 |

#### FR-006: 交差検証
| 項目 | 内容 |
|------|------|
| ID | FR-006 |
| 優先度 | 必須 |
| 説明 | K-Fold交差検証を実行できる |
| 受入条件 | - Fold数を指定可能（3-10）<br>- 各Foldの結果表示<br>- 平均±標準偏差表示 |

#### FR-007: モデル評価
| 項目 | 内容 |
|------|------|
| ID | FR-007 |
| 優先度 | 必須 |
| 説明 | 学習したモデルの性能を評価・可視化できる |
| 受入条件 | - R², RMSE, MAE, MAPE表示<br>- 実測vs予測プロット<br>- 残差分析<br>- 特徴量重要度<br>- ゲージチャート表示 |

#### FR-008: 予測実行
| 項目 | 内容 |
|------|------|
| ID | FR-008 |
| 優先度 | 必須 |
| 説明 | 新しいデータに対して予測を実行できる |
| 受入条件 | - CSV一括予測対応<br>- 手入力単一予測対応<br>- 結果CSVダウンロード<br>- 統計情報表示 |

#### FR-009: モデル保存/読込
| 項目 | 内容 |
|------|------|
| ID | FR-009 |
| 優先度 | 必須 |
| 説明 | 学習したモデルを保存・読み込みできる |
| 受入条件 | - joblib形式で保存<br>- タイムスタンプ付きファイル名<br>- 読み込み後すぐに予測可能 |

---

### 2.2 重要機能（Should Have）

#### FR-010: SHAP分析
| 項目 | 内容 |
|------|------|
| ID | FR-010 |
| 優先度 | 高 |
| 説明 | 予測の根拠をSHAP値で説明できる |
| 受入条件 | - 特徴量重要度プロット<br>- 個別予測の説明<br>- Force Plot風表示<br>- 正/負の寄与を明示 |

#### FR-011: 予測信頼区間
| 項目 | 内容 |
|------|------|
| ID | FR-011 |
| 優先度 | 高 |
| 説明 | 予測の不確実性を信頼区間で表示できる |
| 受入条件 | - 50%, 80%, 95%信頼区間<br>- 区間のビジュアル表示<br>- 残差ベース計算 |

#### FR-012: PDFレポート
| 項目 | 内容 |
|------|------|
| ID | FR-012 |
| 優先度 | 高 |
| 説明 | 予測結果をPDFレポートとして出力できる |
| 受入条件 | - 予測サマリー<br>- 入力条件<br>- SHAP分析結果<br>- モデル性能<br>- 免責事項 |

#### FR-013: What-if分析
| 項目 | 内容 |
|------|------|
| ID | FR-013 |
| 優先度 | 高 |
| 説明 | 条件変更による価格変化をシミュレーションできる |
| 受入条件 | - 感度分析（1変数）<br>- シナリオ比較（複数変数）<br>- 変化率表示<br>- グラフ可視化 |

---

### 2.3 追加機能（Nice to Have）

#### FR-014: 類似物件検索
| 項目 | 内容 |
|------|------|
| ID | FR-014 |
| 優先度 | 中 |
| 説明 | 入力条件に類似した物件を検索できる |
| 受入条件 | - ユークリッド距離/コサイン類似度<br>- 検索件数指定可能<br>- 類似度スコア表示<br>- 予測vs実績比較 |

#### FR-015: データ品質チェック
| 項目 | 内容 |
|------|------|
| ID | FR-015 |
| 優先度 | 中 |
| 説明 | アップロードデータの品質を自動チェックできる |
| 受入条件 | - 重複行検出<br>- 欠損値分析<br>- 異常値検出<br>- 高相関検出<br>- 品質スコア表示 |

#### FR-016: 特徴量自動生成
| 項目 | 内容 |
|------|------|
| ID | FR-016 |
| 優先度 | 中 |
| 説明 | 元の特徴量から新しい特徴量を自動生成できる |
| 受入条件 | - 交互作用項<br>- 多項式特徴量<br>- 比率特徴量<br>- ビニング<br>- CSVダウンロード |

#### FR-017: 予測履歴管理
| 項目 | 内容 |
|------|------|
| ID | FR-017 |
| 優先度 | 中 |
| 説明 | セッション中の予測履歴を管理できる |
| 受入条件 | - 履歴一覧表示<br>- 統計情報<br>- トレンドプロット<br>- CSV/JSONエクスポート |

---

### 2.4 将来機能（Future）

#### FR-018: 地図連携
| 項目 | 内容 |
|------|------|
| ID | FR-018 |
| 優先度 | 低 |
| 説明 | 物件を地図上にプロットできる |

#### FR-019: 時系列予測
| 項目 | 内容 |
|------|------|
| ID | FR-019 |
| 優先度 | 低 |
| 説明 | 将来の価格推移を予測できる |

#### FR-020: API化
| 項目 | 内容 |
|------|------|
| ID | FR-020 |
| 優先度 | 低 |
| 説明 | REST APIとして外部システムと連携できる |

---

## 3. 非機能要件

### 3.1 性能要件

| ID | 項目 | 要件 |
|----|------|------|
| NFR-001 | レスポンス時間 | 通常操作は3秒以内 |
| NFR-002 | モデル学習時間 | 1万行データで5分以内 |
| NFR-003 | チューニング時間 | 50試行で10分以内 |
| NFR-004 | SHAP計算時間 | 500サンプルで30秒以内 |
| NFR-005 | 同時接続数 | 単一ユーザー想定 |

### 3.2 可用性要件

| ID | 項目 | 要件 |
|----|------|------|
| NFR-006 | 稼働時間 | ローカル実行のため制限なし |
| NFR-007 | エラー復旧 | エラー時もアプリは継続動作 |

### 3.3 セキュリティ要件

| ID | 項目 | 要件 |
|----|------|------|
| NFR-008 | データ保護 | ローカル保存のみ、外部送信なし |
| NFR-009 | 認証 | 不要（ローカル実行） |

### 3.4 保守性要件

| ID | 項目 | 要件 |
|----|------|------|
| NFR-010 | コード構造 | モジュール分割（MVC相当） |
| NFR-011 | ドキュメント | 主要関数にdocstring |
| NFR-012 | バージョン管理 | Git対応 |

### 3.5 互換性要件

| ID | 項目 | 要件 |
|----|------|------|
| NFR-013 | Python | 3.9以上 |
| NFR-014 | ブラウザ | Chrome, Firefox, Edge対応 |
| NFR-015 | OS | Windows, macOS, Linux対応 |

---

## 4. 画面要件

### 4.1 タブ構成

```
┌──────────────────────────────────────────────────────────────────┐
│ 📤 データアップロード │ 🔍 EDA │ 🎯 学習 │ 📊 評価 │ 🔮 予測 │ 🔬 詳細 │ 🛠️ ユーティリティ │
└──────────────────────────────────────────────────────────────────┘
```

### 4.2 サイドバー構成

```
┌─────────────────────┐
│ 🏠 ロゴ             │
├─────────────────────┤
│ 設定パネル         │
├─────────────────────┤
│ 🤖 モデル設定       │
│   - アルゴリズム選択 │
│   - スタッキング構成 │
├─────────────────────┤
│ ⚙️ チューニング設定 │
│   - ON/OFF         │
│   - 試行回数       │
│   - 交差検証       │
├─────────────────────┤
│ 🔧 前処理設定       │
│   - 欠損値処理     │
│   - エンコーディング │
│   - 異常値処理     │
│   - スケーリング   │
├─────────────────────┤
│ 💾 モデル管理       │
│   - 保存ボタン     │
│   - 読込アップロード │
└─────────────────────┘
```

---

## 5. データ要件

### 5.1 入力データ形式

| 項目 | 要件 |
|------|------|
| ファイル形式 | CSV (UTF-8) |
| ヘッダー | 必須（1行目） |
| 区切り文字 | カンマ |
| 数値列 | int64, float64 |
| カテゴリ列 | object, category |

### 5.2 出力データ形式

| 出力 | 形式 |
|------|------|
| 予測結果 | CSV (UTF-8-sig) |
| モデル | joblib |
| レポート | PDF |
| 履歴 | CSV / JSON |

---

## 6. 用語定義

| 用語 | 定義 |
|------|------|
| SHAP | SHapley Additive exPlanations。特徴量の貢献度を説明する手法 |
| XGBoost | eXtreme Gradient Boosting。勾配ブースティングアルゴリズム |
| LightGBM | Light Gradient Boosting Machine。高速な勾配ブースティング |
| CatBoost | Categorical Boosting。カテゴリ変数に強いブースティング |
| スタッキング | 複数モデルの予測を組み合わせるアンサンブル手法 |
| 信頼区間 | 予測値が含まれる確率的な範囲 |
| What-if分析 | 条件変更時の影響をシミュレーションする分析 |
| EDA | Exploratory Data Analysis。探索的データ分析 |

---

## 7. 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|----------|
| 1.0 | - | 初版（MVP） |
| 2.0 | - | モデル比較、スタッキング追加 |
| 2.2 | - | SHAP、信頼区間、PDF、What-if追加 |
| 2.3 | 2026-01-01 | ユーティリティタブ追加 |
